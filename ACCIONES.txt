[{"id":"a8f515ea.b8dd38","type":"neo4j","z":"e01f9d46.e3e5a","name":"NEW NODE","url":"http://neo4j:integradora@127.0.0.1:7474","query":"CREATE(:Action {\n\tcode\t: {code},\n\tStatus  : {stat}\n})\n","x":998.9630126953125,"y":70,"wires":[[]]},{"id":"ba5cfbef.e68a68","type":"http response","z":"e01f9d46.e3e5a","name":"RESPONSE ADD","x":684.9630126953125,"y":105.86647033691406,"wires":[]},{"id":"a2a1ecdf.3d535","type":"http in","z":"e01f9d46.e3e5a","name":"ADD ACTION","url":"/ADD/ACTION","method":"get","swaggerDoc":"","x":80.95452880859375,"y":107.99714660644531,"wires":[["57e3a658.3316c8"]]},{"id":"57e3a658.3316c8","type":"function","z":"e01f9d46.e3e5a","name":"Validate ADD","func":"var header = msg.req.query;\nvar stat = header.stat;\nvar code = header.code;\nvar type = header.type;\nvar descr = header.descr;\n\nvar map = {};\nmap.stat=stat;\nmap.code=code;\nmap.type=type;\nmap.descr=descr;\nmsg.payload = map;\nreturn msg;","outputs":"1","noerr":0,"x":199.960205078125,"y":59.91761779785156,"wires":[["83ea8dd3.b8007"]]},{"id":"83ea8dd3.b8007","type":"switch","z":"e01f9d46.e3e5a","name":"DESICION","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"ERROR","vt":"str"},{"t":"else"}],"checkall":"true","outputs":2,"x":314.95166015625,"y":100.17897033691406,"wires":[["e0f18bf.261ad78"],["f2d97158.3ef33"]]},{"id":"87935b3e.824488","type":"http in","z":"e01f9d46.e3e5a","name":"DELETE ACTION","url":"/DELETE/ACTION","method":"post","swaggerDoc":"","x":95,"y":231.7642059326172,"wires":[["811c92ef.9ca6c"]]},{"id":"811c92ef.9ca6c","type":"function","z":"e01f9d46.e3e5a","name":"Validate DELETE","func":"var header = msg.req.headers;\nvar code = header.code;\nvar map = {};\nmap.code=code;\nif(code === undefined || code === null){\n    msg.payload = \"ERROR\";\n    msg.statusCode = 404;\n}\nelse\n    msg.payload = map;\nreturn msg;","outputs":"1","noerr":0,"x":205,"y":178.7642059326172,"wires":[["9890bd7d.d73e3"]]},{"id":"deca2234.22521","type":"neo4j","z":"e01f9d46.e3e5a","name":"DELETE NODE","url":"http://neo4j:integradora@127.0.0.1:7474","query":"MATCH (a:Action {code:{code} })\nOPTIONAL MATCH a-[r]-()\nDELETE a, r","x":460,"y":180.7642059326172,"wires":[["b013419d.3670e"]]},{"id":"9890bd7d.d73e3","type":"switch","z":"e01f9d46.e3e5a","name":"DESICION","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"ERROR","vt":"str"},{"t":"else"}],"checkall":"true","outputs":2,"x":313,"y":230.7642059326172,"wires":[["deca2234.22521"],["88c66d10.cf8df"]]},{"id":"a9beb422.feb3b8","type":"http response","z":"e01f9d46.e3e5a","name":"RESPONSE DELETE","x":681,"y":229.76422119140625,"wires":[]},{"id":"88c66d10.cf8df","type":"http response","z":"e01f9d46.e3e5a","name":"ERROR DELETE","x":483,"y":266.76422119140625,"wires":[]},{"id":"f2d97158.3ef33","type":"http response","z":"e01f9d46.e3e5a","name":"ERROR ADD","x":481,"y":131.7642059326172,"wires":[]},{"id":"b013419d.3670e","type":"function","z":"e01f9d46.e3e5a","name":"SEARCH","func":"var pay = msg.payload;\nif(pay.data.length === 0){\n    msg.statusCode = 404;\n    msg.payload=\"NOT FOUND\"\n}\nreturn msg;","outputs":1,"noerr":0,"x":639,"y":176.7642059326172,"wires":[["a9beb422.feb3b8"]]},{"id":"8710a1a1.d6589","type":"function","z":"e01f9d46.e3e5a","name":"Validate INFO","func":"var parameters = msg.req.query;\nif(parameters.code === null || \n    parameters.code === undefined ||\n    parameters.stat === null ||\n    parameters.stat === undefined){\n        msg.statusCode = 404;\n        msg.payload = \"ERROR\";\n}\nelse\n    msg.payload = parameters;\nreturn msg;","outputs":"1","noerr":0,"x":202.9630126953125,"y":441,"wires":[["283dbc8.34da444"]]},{"id":"a913b85e.e92018","type":"neo4j","z":"e01f9d46.e3e5a","name":"MODIFY NODE","url":"http://neo4j:integradora@127.0.0.1:7474","query":"MATCH (a:Action { code: {code} })\nSET a.Status = {stat} \nRETURN a","x":459.9630126953125,"y":455,"wires":[["49f75b20.021dd4"]]},{"id":"283dbc8.34da444","type":"switch","z":"e01f9d46.e3e5a","name":"DESICION","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"ERROR","vt":"str"},{"t":"else"}],"checkall":"true","outputs":2,"x":301.9630126953125,"y":508,"wires":[["a913b85e.e92018","65f18926.b95388"],["139a1941.b57257"]]},{"id":"365c7044.1aae5","type":"http response","z":"e01f9d46.e3e5a","name":"RESPONSE INFO","x":803.9630126953125,"y":521,"wires":[]},{"id":"139a1941.b57257","type":"http response","z":"e01f9d46.e3e5a","name":"ERROR MODIFY","x":478.9630126953125,"y":541,"wires":[]},{"id":"49f75b20.021dd4","type":"function","z":"e01f9d46.e3e5a","name":"SEARCH","func":"var pay = msg.payload;\nif(pay.data.length === 0){\n    msg.statusCode = 404;\n    msg.payload=\"NOT FOUND\"\n}\nreturn msg;","outputs":1,"noerr":0,"x":783.9630126953125,"y":468,"wires":[["365c7044.1aae5"]]},{"id":"4033422d.85726c","type":"http in","z":"e01f9d46.e3e5a","name":"CHANGE STATE","url":"/CHANGE/STATE","method":"get","swaggerDoc":"","x":86.06245422363281,"y":511.3636474609375,"wires":[["8710a1a1.d6589"]]},{"id":"65f18926.b95388","type":"neo4j","z":"e01f9d46.e3e5a","name":"CASCADE_ACTIONS","url":"http://neo4j:integradora@127.0.0.1:7474","query":"MATCH (action {code:{code}})<-[:HAVE]-(object)-[:link]->(objects)-[:HAVE]->(actions) SET actions.Status={stat} RETURN actions","x":507.75,"y":497.75,"wires":[[]]},{"id":"e0f18bf.261ad78","type":"neo4j","z":"e01f9d46.e3e5a","name":"NEW NODE","url":"http://neo4j:integradora@127.0.0.1:7474","query":"CREATE(:Action {code: {code}, Status  : {stat}, Type  : {type}, Description  : {descr}})","x":480.566650390625,"y":38.56666564941406,"wires":[["ba5cfbef.e68a68"]]},{"id":"dd5e53a3.933cf","type":"http in","z":"e01f9d46.e3e5a","name":"INFO ACTION","url":"/INFO/ACTION","method":"get","swaggerDoc":"","x":85,"y":376.6666564941406,"wires":[["cee819fd.20b6f8"]]},{"id":"cee819fd.20b6f8","type":"function","z":"e01f9d46.e3e5a","name":"Validate INFO","func":"var parameters = msg.req.query;\nif(parameters.code === null || \n    parameters.code === undefined){\n    msg.statusCode = 404;\n    msg.payload = \"ERROR\";\n}\nelse\n    msg.payload = parameters;\nreturn msg;","outputs":"1","noerr":0,"x":178,"y":325.6666564941406,"wires":[["92c450c7.ef3a2"]]},{"id":"92c450c7.ef3a2","type":"switch","z":"e01f9d46.e3e5a","name":"DESICION","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"ERROR","vt":"str"},{"t":"else"}],"checkall":"true","outputs":2,"x":284,"y":373.6666564941406,"wires":[["d2ab68f5.933a58"],["c96851ef.2a164"]]},{"id":"66a7b040.c8262","type":"http response","z":"e01f9d46.e3e5a","name":"RESPONSE INFO","x":694,"y":410.6666564941406,"wires":[]},{"id":"c96851ef.2a164","type":"http response","z":"e01f9d46.e3e5a","name":"ERROR INFO","x":451,"y":406.6666564941406,"wires":[]},{"id":"4519e8c9.dba148","type":"function","z":"e01f9d46.e3e5a","name":"SEARCH","func":"var pay = msg.payload;\nif(pay.data.length === 0){\n    msg.statusCode = 404;\n    msg.payload=\"NOT FOUND\"\n}\nreturn msg;","outputs":1,"noerr":0,"x":573,"y":364.6666564941406,"wires":[["66a7b040.c8262","d34040d6.b7852"]]},{"id":"8faa1ee9.9b4a4","type":"debug","z":"e01f9d46.e3e5a","name":"","active":true,"console":"false","complete":"false","x":707,"y":298.9024353027344,"wires":[]},{"id":"d34040d6.b7852","type":"debug","z":"e01f9d46.e3e5a","name":"","active":true,"console":"false","complete":"false","x":726,"y":346.9024353027344,"wires":[]},{"id":"d2ab68f5.933a58","type":"neo4j","z":"e01f9d46.e3e5a","name":"INFO NODE","url":"http://neo4j:integradora@127.0.0.1:7474","query":"MATCH (a:Action {code:{code} })\nRETURN a","x":442,"y":318.9024353027344,"wires":[["4519e8c9.dba148","8faa1ee9.9b4a4"]]},{"id":"97ccea14.ca98e8","type":"http in","z":"e01f9d46.e3e5a","name":"INFO ACTIONS BY OBJECT","url":"/INFO/ACTIONSBYOBJECT","method":"get","swaggerDoc":"","x":125,"y":708.6666870117188,"wires":[["1fe168a9.1988b7"]]},{"id":"1fe168a9.1988b7","type":"function","z":"e01f9d46.e3e5a","name":"Validate INFO","func":"var parameters = msg.req.query;\nif(parameters.code === null || \n    parameters.code === undefined){\n    msg.statusCode = 404;\n    msg.payload = \"ERROR\";\n}\nelse\n    msg.payload = parameters;\nreturn msg;","outputs":"1","noerr":0,"x":286.7142868041992,"y":652.1667280197144,"wires":[["8c16f3f9.4932a"]]},{"id":"8c16f3f9.4932a","type":"switch","z":"e01f9d46.e3e5a","name":"DESICION","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"ERROR","vt":"str"},{"t":"else"}],"checkall":"true","outputs":2,"x":392.7142868041992,"y":700.1667280197144,"wires":[["dbb7311a.94736"],["59d11bc2.d08884"]]},{"id":"4008be2c.b5b55","type":"http response","z":"e01f9d46.e3e5a","name":"RESPONSE INFO","x":746.7142868041992,"y":736.1667280197144,"wires":[]},{"id":"59d11bc2.d08884","type":"http response","z":"e01f9d46.e3e5a","name":"ERROR INFO","x":521.7142868041992,"y":746.1667280197144,"wires":[]},{"id":"c9472161.6eda9","type":"function","z":"e01f9d46.e3e5a","name":"SEARCH","func":"var pay = msg.payload;\nif(pay.data.length === 0){\n    msg.statusCode = 404;\n    msg.payload=\"NOT FOUND\"\n}\nreturn msg;","outputs":1,"noerr":0,"x":713.7142868041992,"y":647.1667280197144,"wires":[["4008be2c.b5b55"]]},{"id":"dbb7311a.94736","type":"neo4j","z":"e01f9d46.e3e5a","name":"ACTIONS_BY_OBJECT","url":"http://neo4j:integradora@127.0.0.1:7474","query":"MATCH (object{code:{code}})-[:HAVE]->(action) RETURN action","x":528.3333511352539,"y":615.3334140777588,"wires":[["c9472161.6eda9"]]},{"id":"cf18eb1d.522eb8","type":"function","z":"e01f9d46.e3e5a","name":"Validate INFO","func":"var parameters = msg.req.query;\nif(parameters.code === null || \n    parameters.code === undefined ||\n    parameters.stat === null ||\n    parameters.stat === undefined){\n        msg.statusCode = 404;\n        msg.payload = \"ERROR\";\n}\nelse\n    msg.payload = parameters;\nreturn msg;","outputs":"1","noerr":0,"x":267.1505355834961,"y":910.9375,"wires":[["e16f7e45.95dc7"]]},{"id":"e16f7e45.95dc7","type":"switch","z":"e01f9d46.e3e5a","name":"DESICION","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"ERROR","vt":"str"},{"t":"else"}],"checkall":"true","outputs":2,"x":397.1505661010742,"y":993.6875014305115,"wires":[["9366e58b.ac0008","797438b.06c47c8"],["df2292e0.5abce"]]},{"id":"50abc14c.b1dfc","type":"http response","z":"e01f9d46.e3e5a","name":"RESPONSE INFO","x":906.6505584716797,"y":949.1874933242798,"wires":[]},{"id":"df2292e0.5abce","type":"http response","z":"e01f9d46.e3e5a","name":"ERROR MODIFY","x":604.1505813598633,"y":999.1875143051147,"wires":[]},{"id":"7b24299f.0fb408","type":"function","z":"e01f9d46.e3e5a","name":"SEARCH","func":"var pay = msg.payload;\nif(pay.data.length === 0){\n    msg.statusCode = 404;\n    msg.payload=\"NOT FOUND\"\n}\nreturn msg;","outputs":1,"noerr":0,"x":886.6505584716797,"y":896.1874933242798,"wires":[["50abc14c.b1dfc","e9a56eed.9bb8f"]]},{"id":"5225a29b.6aa90c","type":"http in","z":"e01f9d46.e3e5a","name":"CHANGE STATE","url":"/CHANGE/STATE","method":"get","swaggerDoc":"","x":122.5,"y":990.8011484146118,"wires":[["cf18eb1d.522eb8"]]},{"id":"9366e58b.ac0008","type":"neo4j","z":"e01f9d46.e3e5a","name":"CASCADE_ACTIONS","url":"http://neo4j:L4BPR0T0@200.126.23.138:7474","query":"MATCH (action {code:{code}})<-[:HAVE]-(object)-[:link]->(objects)-[:HAVE]->(actions) SET actions.Status={stat} RETURN actions","x":636.6875381469727,"y":947.1875133514404,"wires":[[]]},{"id":"e9a56eed.9bb8f","type":"debug","z":"e01f9d46.e3e5a","name":"","active":true,"console":"false","complete":"payload.data[0][0].ip","x":1106.275619506836,"y":875.2772150039673,"wires":[]},{"id":"8879de61.76fcc","type":"function","z":"e01f9d46.e3e5a","name":"PREPARE TCP","func":"var pay=msg.payload;\n// var ip=pay.data[1].ip;\n// var value = pay.data[0];\n// msg.host=ip;\n// msg.port=8090;\n// msg.payload=\"GET /\"+value+\" HTTP/1.1\\r\\n\\r\\n\";\n// return msg;\n\nvar ip=pay.data[0][0].ip;\nvar value=pay.data[0][1];\nmsg.host=ip;\nmsg.port=8090;\nmsg.payload=\"GET /?VALUE:\"+value+\" HTTP/1.1\\r\\n\\r\\n\";\n// var j=global.get('i');\n// global.set('i',j+1);\nreturn msg;","outputs":1,"noerr":0,"x":466.52008056640625,"y":1151.8397760391235,"wires":[["47d9f8cf.400458","ff623bff.a96a18"]]},{"id":"47d9f8cf.400458","type":"tcp request","z":"e01f9d46.e3e5a","server":"","port":"","out":"time","splitc":"100","name":"TCP REQUEST","x":710.5202178955078,"y":1131.8396997451782,"wires":[["2ae7530e.fee96c","74746362.6ef4ac"]]},{"id":"74746362.6ef4ac","type":"debug","z":"e01f9d46.e3e5a","name":"","active":true,"console":"false","complete":"true","x":1073.353500366211,"y":1205.7529230117798,"wires":[]},{"id":"285de7f7.e797a8","type":"switch","z":"e01f9d46.e3e5a","name":"","property":"fin","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"str"},{"t":"else"}],"checkall":"true","outputs":2,"x":957.0201110839844,"y":1020.1730279922485,"wires":[[],["74746362.6ef4ac"]]},{"id":"2ae7530e.fee96c","type":"function","z":"e01f9d46.e3e5a","name":"","func":"\n    msg.fin=1;\n","outputs":1,"noerr":0,"x":837.0201110839844,"y":1065.506402015686,"wires":[["285de7f7.e797a8"]]},{"id":"ff623bff.a96a18","type":"debug","z":"e01f9d46.e3e5a","name":"","active":true,"console":"false","complete":"true","x":617.0201568603516,"y":1263.1730737686157,"wires":[]},{"id":"797438b.06c47c8","type":"neo4j","z":"e01f9d46.e3e5a","name":"MODIFY NODE V2","url":"http://neo4j:L4BPR0T0@200.126.23.138:7474","query":"MATCH (a:Action { code:{code}})<-[:HAVE]-(obj)<-[:HAVE]-(dev) SET a.Status = {stat} RETURN dev,a.Status","x":619.8679656982422,"y":874.7527093887329,"wires":[["8879de61.76fcc","7b24299f.0fb408"]]}]