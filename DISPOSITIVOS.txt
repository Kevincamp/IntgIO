[{"id":"4012b344.00007c","type":"tab","label":"Dispositivos"},{"id":"859c24ac.ad6b18","type":"http response","z":"4012b344.00007c","name":"RESPONSE ADD","x":688.0084686279297,"y":108.86647033691406,"wires":[]},{"id":"6b61dd6b.311754","type":"http in","z":"4012b344.00007c","name":"ADD DEVICE","url":"/ADD/DEVICE","method":"get","swaggerDoc":"","x":75,"y":142.9971466064453,"wires":[["a08fbe70.3f246"]]},{"id":"a08fbe70.3f246","type":"function","z":"4012b344.00007c","name":"Validate ADD","func":"//var header = msg.req.headers;\nvar header = msg.req.query;\nvar code = header.code;\nvar model = header.model;\nvar type = header.type;\nvar type_com = header.typeCom;\nvar ip = header.ip;\nvar puerto = header.puerto;\nvar com ;\nvar online = header.online;\n\nvar map = {};\nif(type_com == \"serial\"){\n    com = header.com;\n    map.com=com;\n}else{\n    com = \"\";\n    map.com=com;\n}\nmap.ip=ip;\nmap.code=code;\nmap.online=online;\nmap.type=type;\nmap.type_com=type_com;\nmap.puerto=puerto;\nmap.model=model;\n\nif(code === undefined || online===undefined || \n   ip === undefined || model === undefined ||\n   type === undefined){\n        msg.payload = \"ERROR\";\n        msg.statusCode = 404;\n}\nelse\n    msg.payload = map;    \nreturn msg;","outputs":"1","noerr":0,"x":216.00567626953125,"y":85.91761779785156,"wires":[["18ddadb5.ad31e2"]]},{"id":"18ddadb5.ad31e2","type":"switch","z":"4012b344.00007c","name":"DESICION","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"ERROR","vt":"str"},{"t":"else"}],"checkall":"true","outputs":2,"x":326.9971160888672,"y":142.17897033691406,"wires":[["16a30dde.9254a2"],["a9f52ab3.76abb8"]]},{"id":"7efff213.6249dc","type":"http in","z":"4012b344.00007c","name":"DELETE DEVICE","url":"/DELETE/DEVICE","method":"post","swaggerDoc":"","x":110.04545593261719,"y":289.76422119140625,"wires":[["d5944d27.40ea8"]]},{"id":"d5944d27.40ea8","type":"function","z":"4012b344.00007c","name":"Validate DELETE","func":"var header = msg.req.headers;\nvar code = header.code;\nvar map = {};\nmap.code=code;\nif(code === undefined || code === null){\n    msg.payload = \"ERROR\";\n    msg.statusCode = 404;\n}\nelse\n    msg.payload = map;\nreturn msg;","outputs":"1","noerr":0,"x":222.0454559326172,"y":215.7642059326172,"wires":[["484d82b6.8693fc"]]},{"id":"7b5d0449.0bf88c","type":"neo4j","z":"4012b344.00007c","name":"DELETE NODE","url":"http://neo4j:integradora@127.0.0.1:7474","query":"MATCH (d:Device {code:{code} })\nOPTIONAL MATCH d-[r]-()\nDELETE d, r","x":485.0454559326172,"y":220.7642059326172,"wires":[["fc613c7a.cf5e7"]]},{"id":"484d82b6.8693fc","type":"switch","z":"4012b344.00007c","name":"DESICION","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"ERROR","vt":"str"},{"t":"else"}],"checkall":"true","outputs":2,"x":326.0454559326172,"y":285.7642059326172,"wires":[["7b5d0449.0bf88c"],["2ba7e0ab.db9f6"]]},{"id":"1174a047.0faeb","type":"http response","z":"4012b344.00007c","name":"RESPONSE DELETE","x":721.0454559326172,"y":286.7642059326172,"wires":[]},{"id":"2ba7e0ab.db9f6","type":"http response","z":"4012b344.00007c","name":"ERROR DELETE","x":512.0454559326172,"y":317.7642059326172,"wires":[]},{"id":"a9f52ab3.76abb8","type":"http response","z":"4012b344.00007c","name":"ERROR ADD","x":497.0454559326172,"y":168.7642059326172,"wires":[]},{"id":"fc613c7a.cf5e7","type":"function","z":"4012b344.00007c","name":"SEARCH","func":"var pay = msg.payload;\nif(pay.data.length === 0){\n    msg.statusCode = 404;\n    msg.payload=\"NOT FOUND\"\n}\nreturn msg;","outputs":1,"noerr":0,"x":707.0454559326172,"y":220.7642059326172,"wires":[["1174a047.0faeb"]]},{"id":"6f586997.4890f8","type":"neo4j","z":"4012b344.00007c","name":"COMPLETE DEVICE","url":"http://neo4j:integradora@127.0.0.1:7474","query":"match(device {code:{code}})-[:HAVE]->(object)-[:HAVE]->(action) return device,object,action","x":468,"y":797,"wires":[["f1f6bbbb.d9703","320eca55.e3390e"]]},{"id":"458853e5.56597c","type":"http in","z":"4012b344.00007c","name":"COMPLETE DEVICE","url":"/COMPLETE/DEVICE","method":"get","swaggerDoc":"","x":118,"y":889,"wires":[["1fc2776f.07e9f1"]]},{"id":"1fc2776f.07e9f1","type":"function","z":"4012b344.00007c","name":"Validate INFO","func":"var parameters = msg.req.query;\nif(parameters.code === null || \n    parameters.code === undefined){\n    msg.statusCode = 404;\n    msg.payload = \"ERROR\";\n}\nelse\n    msg.payload = parameters;\nreturn msg;","outputs":"1","noerr":0,"x":218,"y":812,"wires":[["3e3d9360.650204"]]},{"id":"3e3d9360.650204","type":"switch","z":"4012b344.00007c","name":"DESICION","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"ERROR","vt":"str"},{"t":"else"}],"checkall":"true","outputs":2,"x":324,"y":860,"wires":[["6f586997.4890f8"],["b9fb8c16.4f90d"]]},{"id":"4667b500.06dd2c","type":"http response","z":"4012b344.00007c","name":"RESPONSE INFO","x":678,"y":896,"wires":[]},{"id":"b9fb8c16.4f90d","type":"http response","z":"4012b344.00007c","name":"ERROR INFO","x":453,"y":906,"wires":[]},{"id":"f1f6bbbb.d9703","type":"function","z":"4012b344.00007c","name":"SEARCH","func":"var pay = msg.payload;\nif(pay.data.length === 0){\n    msg.statusCode = 404;\n    msg.payload=\"NOT FOUND\"\n}\nreturn msg;","outputs":1,"noerr":0,"x":603.9999694824219,"y":842.0000152587891,"wires":[["4667b500.06dd2c"]]},{"id":"320eca55.e3390e","type":"debug","z":"4012b344.00007c","name":"","active":true,"console":"false","complete":"payload","x":775.9545593261719,"y":808.2357940673828,"wires":[]},{"id":"91ab3ae3.fac4e8","type":"http in","z":"4012b344.00007c","name":"DEVICE OBJECTS","url":"/DEVICE/OBJECTS","method":"get","swaggerDoc":"","x":123,"y":1094,"wires":[["ac935310.c876e"]]},{"id":"ac935310.c876e","type":"function","z":"4012b344.00007c","name":"Validate INFO","func":"var parameters = msg.req.query;\nif(parameters.code === null || \n    parameters.code === undefined){\n    msg.statusCode = 404;\n    msg.payload = \"ERROR\";\n}\nelse\n    msg.payload = parameters;\nreturn msg;","outputs":"1","noerr":0,"x":253,"y":1039,"wires":[["9131ab17.aa3ac","d0e49dfa.b1cd"]]},{"id":"9131ab17.aa3ac","type":"switch","z":"4012b344.00007c","name":"DESICION","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"ERROR","vt":"str"},{"t":"else"}],"checkall":"true","outputs":2,"x":359,"y":1087,"wires":[[],["24cf4c98.d61994"]]},{"id":"3d2b1f01.2e9478","type":"http response","z":"4012b344.00007c","name":"RESPONSE INFO","x":808,"y":1133,"wires":[]},{"id":"24cf4c98.d61994","type":"http response","z":"4012b344.00007c","name":"ERROR INFO","x":488,"y":1133,"wires":[]},{"id":"69103925.9142a8","type":"function","z":"4012b344.00007c","name":"SEARCH","func":"var pay = msg.payload;\nif(pay.data.length === 0){\n    msg.statusCode = 404;\n    msg.payload=\"NOT FOUND\"\n}\nreturn msg;","outputs":1,"noerr":0,"x":632.9999847412109,"y":1066,"wires":[["3d2b1f01.2e9478"]]},{"id":"7bfc224.07b2d5c","type":"debug","z":"4012b344.00007c","name":"","active":true,"console":"false","complete":"payload","x":810.9545593261719,"y":1035.2357940673828,"wires":[]},{"id":"4e3dd061.dc8c8","type":"http in","z":"4012b344.00007c","name":"DEVICE OBJECTS OUT","url":"/DEVICE/OBJECTS/OUT","method":"get","swaggerDoc":"","x":131.75,"y":1476.75,"wires":[["74c499e7.9c225"]]},{"id":"74c499e7.9c225","type":"function","z":"4012b344.00007c","name":"Validate INFO","func":"var parameters = msg.req.query;\nif(parameters.code === null || \n    parameters.code === undefined){\n    msg.statusCode = 404;\n    msg.payload = \"ERROR\";\n}\nelse\n    msg.payload = parameters;\nreturn msg;","outputs":"1","noerr":0,"x":275.75,"y":1370.75,"wires":[["f3b46cbd.ae1bd","c5fb77e7.b5fe6"]]},{"id":"f3b46cbd.ae1bd","type":"switch","z":"4012b344.00007c","name":"DESICION","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"ERROR","vt":"str"},{"t":"else"}],"checkall":"true","outputs":2,"x":394.75,"y":1480.75,"wires":[[],["217edbef.7f5724"]]},{"id":"734ea53e.a0285c","type":"http response","z":"4012b344.00007c","name":"RESPONSE INFO","x":843.75,"y":1526.75,"wires":[]},{"id":"217edbef.7f5724","type":"http response","z":"4012b344.00007c","name":"ERROR INFO","x":523.75,"y":1526.75,"wires":[]},{"id":"4d434e65.11cb8","type":"function","z":"4012b344.00007c","name":"SEARCH","func":"var pay = msg.payload;\nif(pay.data.length === 0){\n    msg.statusCode = 404;\n    msg.payload=\"NOT FOUND\"\n}\nreturn msg;","outputs":1,"noerr":0,"x":668.7499847412109,"y":1459.75,"wires":[["734ea53e.a0285c"]]},{"id":"26cbeb2b.76a524","type":"debug","z":"4012b344.00007c","name":"","active":true,"console":"false","complete":"payload","x":846.7045593261719,"y":1428.9857940673828,"wires":[]},{"id":"d0e49dfa.b1cd","type":"neo4j","z":"4012b344.00007c","name":"DEVICE FOR OBJECTS","url":"http://neo4j:integradora@127.0.0.1:7474","query":"MATCH (o:Object{code:{code}})-[:HAVE]->(a) MATCH (o:Object{code:{code}})<-[:HAVE]-(d) RETURN d,o,a","x":508.75,"y":994.75,"wires":[["7bfc224.07b2d5c","69103925.9142a8"]]},{"id":"c5fb77e7.b5fe6","type":"neo4j","z":"4012b344.00007c","name":"PERSONAL OBJECT OUTGOING","url":"http://neo4j:integradora@127.0.0.1:7474","query":"MATCH (o:Object{code:{code}})-[:link]->(obs) RETURN obs","x":530.75,"y":1338.75,"wires":[["26cbeb2b.76a524","4d434e65.11cb8"]]},{"id":"8996431a.715ce","type":"neo4j","z":"4012b344.00007c","name":"PERSONAL OBJECT INCOMMING","url":"http://neo4j:integradora@127.0.0.1:7474","query":"MATCH (o:Object{code:{code}})<-[:link]-(obs) RETURN obs","x":570.75,"y":1627.75,"wires":[["dfec6c2.a69ba1","9000d89a.324a7"]]},{"id":"aec03805.b8d51","type":"http in","z":"4012b344.00007c","name":"DEVICE OBJECTS IN","url":"/DEVICE/OBJECTS/IN","method":"get","swaggerDoc":"","x":122.75,"y":1733.75,"wires":[["9be8a93b.055d3"]]},{"id":"9be8a93b.055d3","type":"function","z":"4012b344.00007c","name":"Validate INFO","func":"var parameters = msg.req.query;\nif(parameters.code === null || \n    parameters.code === undefined){\n    msg.statusCode = 404;\n    msg.payload = \"ERROR\";\n}\nelse\n    msg.payload = parameters;\nreturn msg;","outputs":"1","noerr":0,"x":276.75,"y":1627.75,"wires":[["f2f5e472.ff7678","8996431a.715ce"]]},{"id":"f2f5e472.ff7678","type":"switch","z":"4012b344.00007c","name":"DESICION","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"ERROR","vt":"str"},{"t":"else"}],"checkall":"true","outputs":2,"x":395.75,"y":1737.75,"wires":[[],["3ece6c7e.a5003c"]]},{"id":"743fb574.bb08c4","type":"http response","z":"4012b344.00007c","name":"RESPONSE INFO","x":844.75,"y":1783.75,"wires":[]},{"id":"3ece6c7e.a5003c","type":"http response","z":"4012b344.00007c","name":"ERROR INFO","x":524.75,"y":1783.75,"wires":[]},{"id":"9000d89a.324a7","type":"function","z":"4012b344.00007c","name":"SEARCH","func":"var pay = msg.payload;\nif(pay.data.length === 0){\n    msg.statusCode = 404;\n    msg.payload=\"NOT FOUND\"\n}\nreturn msg;","outputs":1,"noerr":0,"x":669.7499847412109,"y":1716.75,"wires":[["743fb574.bb08c4"]]},{"id":"dfec6c2.a69ba1","type":"debug","z":"4012b344.00007c","name":"","active":true,"console":"false","complete":"payload","x":847.7045593261719,"y":1685.9857940673828,"wires":[]},{"id":"16a30dde.9254a2","type":"neo4j","z":"4012b344.00007c","name":"NEW NODE","url":"http://neo4j:integradora@127.0.0.1:7474","query":"create(:Device {code : {code}, model : {model}, type : {type}, type_Comunication : {type_com}, ip : {ip}, puerto : {puerto}, COM:{com}, online: {online}})","x":468.566650390625,"y":55.56666564941406,"wires":[["859c24ac.ad6b18"]]},{"id":"ad41d889.f1b4a8","type":"http in","z":"4012b344.00007c","name":"INFO DEVICE","url":"/INFO/DEVICE","method":"get","swaggerDoc":"","x":93,"y":462.6666793823242,"wires":[["c2e42621.825e18"]]},{"id":"c2e42621.825e18","type":"function","z":"4012b344.00007c","name":"Validate INFO","func":"var parameters = msg.req.query;\nif(parameters.code === null || \n    parameters.code === undefined){\n    msg.statusCode = 404;\n    msg.payload = \"ERROR\";\n}\nelse\n    msg.payload = parameters;\nreturn msg;","outputs":"1","noerr":0,"x":196,"y":411.6666793823242,"wires":[["73a8aff6.c5f49"]]},{"id":"5b4ff283.31dc0c","type":"neo4j","z":"4012b344.00007c","name":"INFO NODE","url":"http://neo4j:integradora@127.0.0.1:7474","query":"MATCH (d:Device {code:{code} })\nRETURN d","x":423,"y":407.6666793823242,"wires":[["98fc57f0.c99498","4ebbb097.9e213"]]},{"id":"73a8aff6.c5f49","type":"switch","z":"4012b344.00007c","name":"DESICION","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"ERROR","vt":"str"},{"t":"else"}],"checkall":"true","outputs":2,"x":302,"y":459.6666793823242,"wires":[["5b4ff283.31dc0c"],["17584fa1.56879"]]},{"id":"7a152d42.43ff04","type":"http response","z":"4012b344.00007c","name":"RESPONSE INFO","x":656,"y":495.6666793823242,"wires":[]},{"id":"17584fa1.56879","type":"http response","z":"4012b344.00007c","name":"ERROR INFO","x":431,"y":505.6666793823242,"wires":[]},{"id":"98fc57f0.c99498","type":"function","z":"4012b344.00007c","name":"SEARCH","func":"var pay = msg.payload;\nif(pay.data.length === 0){\n    msg.statusCode = 404;\n    msg.payload=\"NOT FOUND\"\n}\nreturn msg;","outputs":1,"noerr":0,"x":581.9999694824219,"y":441.6666946411133,"wires":[["7a152d42.43ff04"]]},{"id":"4ebbb097.9e213","type":"debug","z":"4012b344.00007c","name":"","active":true,"console":"false","complete":"payload","x":753.9545593261719,"y":407.90247344970703,"wires":[]},{"id":"31b11378.94848c","type":"http in","z":"4012b344.00007c","name":"DELETE COMPLETE DEVICE","url":"/DELETE/COMPLETE/DEVICE","method":"get","swaggerDoc":"","x":162.56666564941406,"y":2020.7667236328125,"wires":[["1e8a3dc4.7aa712"]]},{"id":"1e8a3dc4.7aa712","type":"function","z":"4012b344.00007c","name":"Validate DELETE","func":"var header = msg.req.query;\nvar code = header.code;\nvar map = {};\nmap.code=code;\nif(code === undefined || code === null){\n    msg.payload = \"ERROR\";\n    msg.statusCode = 404;\n}\nelse\n    msg.payload = map;\nreturn msg;","outputs":"1","noerr":0,"x":256.56666564941406,"y":1874.7667083740234,"wires":[["6e65883f.11aff","39b6ad5.34ba752"]]},{"id":"6e65883f.11aff","type":"switch","z":"4012b344.00007c","name":"DESICION","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"ERROR","vt":"str"},{"t":"else"}],"checkall":"true","outputs":2,"x":360.56666564941406,"y":1944.7667083740234,"wires":[[],["ac7891d5.f22658"]]},{"id":"3b608380.bab4fc","type":"http response","z":"4012b344.00007c","name":"RESPONSE DELETE","x":815.566650390625,"y":1968.7667236328125,"wires":[]},{"id":"ac7891d5.f22658","type":"http response","z":"4012b344.00007c","name":"ERROR DELETE","x":546.5666656494141,"y":1976.7667083740234,"wires":[]},{"id":"327ca2fd.19112e","type":"function","z":"4012b344.00007c","name":"SEARCH","func":"var pay = msg.payload;\nif(pay.data.length === 0){\n    msg.statusCode = 404;\n    msg.payload=\"NOT FOUND\"\n}\nreturn msg;","outputs":1,"noerr":0,"x":851.566650390625,"y":1879.7667236328125,"wires":[["3b608380.bab4fc"]]},{"id":"1f03230d.1f7065","type":"http in","z":"4012b344.00007c","name":"MODIFY DEVICE","url":"/MODIFY/DEVICE","method":"get","swaggerDoc":"","x":97.56666564941406,"y":641.566650390625,"wires":[["a73c8ef.922d1f"]]},{"id":"a73c8ef.922d1f","type":"function","z":"4012b344.00007c","name":"Validate INFO","func":"var parameters = msg.req.query;\nif(parameters.code === null || \n    parameters.code === undefined){\n    msg.statusCode = 404;\n    msg.payload = \"ERROR\";\n}\nelse\n    msg.payload = parameters;\nreturn msg;","outputs":"1","noerr":0,"x":190.56666564941406,"y":590.566650390625,"wires":[["7016d2c9.786674"]]},{"id":"7016d2c9.786674","type":"switch","z":"4012b344.00007c","name":"DESICION","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"ERROR","vt":"str"},{"t":"else"}],"checkall":"true","outputs":2,"x":300.566650390625,"y":643.566650390625,"wires":[["dcae5df4.10b998"],["365ffa4d.13e706"]]},{"id":"ce0f86f9.794cf8","type":"http response","z":"4012b344.00007c","name":"RESPONSE INFO","x":739.5666351318359,"y":682.566650390625,"wires":[]},{"id":"365ffa4d.13e706","type":"http response","z":"4012b344.00007c","name":"ERROR INFO","x":458.56663513183594,"y":697.566650390625,"wires":[]},{"id":"e9f40f40.7e39e","type":"function","z":"4012b344.00007c","name":"SEARCH","func":"var pay = msg.payload;\nif(pay.data.length === 0){\n    msg.statusCode = 404;\n    msg.payload=\"NOT FOUND\"\n}\nreturn msg;","outputs":1,"noerr":0,"x":643.5666351318359,"y":598.566650390625,"wires":[["ce0f86f9.794cf8"]]},{"id":"dcae5df4.10b998","type":"neo4j","z":"4012b344.00007c","name":"Modify Device","url":"http://neo4j:integradora@127.0.0.1:7474","query":"MATCH (d:Device {code:{code} }) SET d.model = {model}, d.type = {type}, d.ip = {ip} RETURN d","x":475.6338119506836,"y":582.9135093688965,"wires":[["e9f40f40.7e39e"]]},{"id":"39b6ad5.34ba752","type":"neo4j","z":"4012b344.00007c","name":"DELETE NODE COMPLETE DEVIC","url":"http://neo4j:integradora@127.0.0.1:7474","query":"MATCH (a:Device {code:{code} }) OPTIONAL MATCH (a)-[r]->(b:Object) OPTIONAL MATCH (b)-[r1]->(c:Action) OPTIONAL MATCH (b)<-[r2]-(d) OPTIONAL MATCH (b)-[r3]->(d) delete a,b,c,r,r1,r2,r3","x":570.566650390625,"y":1871.066650390625,"wires":[["327ca2fd.19112e"]]}]